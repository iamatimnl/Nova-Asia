<style>
  .orders-wrapper {
    overflow-x: auto;
    max-width: 100%;
  }

.orders-wrapper {
    overflow-x: auto;
    display: block;
    width: 100%;
    max-width: 100vw;
  }

  table.orders-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1200px;
  }

  .orders-table th, .orders-table td {
    border: 1px solid #ccc;
    padding: 8px;
    white-space: nowrap;
    text-align: left;
  }

  .orders-table thead {
    background-color: #f9f9f9;
    position: sticky;
    top: 0;
    z-index: 2;
  }

  td:last-child,
  th:last-child {
    padding-right: 20px;
  }

  .completed { background-color: #c8e6c9; }
  .cancelled { background-color: #e0e0e0; }

  .type-bezorging {
    color: red;
    font-weight: bold;
  }

  .type-afhalen {
    color: green;
    font-weight: bold;
  }
  
  table.orders-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1200px; /* ÈÅøÂÖçÂ§™Á™Ñ */
  }

  .orders-table th, .orders-table td {
    border: 1px solid #ccc;
    padding: 8px;
    white-space: nowrap; /* ‰∏çÊç¢Ë°å */
    text-align: left;
  }

  .orders-table thead {
    background-color: #f9f9f9;
    position: sticky;
    top: 0;
    z-index: 2;
  }
  td:last-child,
th:last-child {
  padding-right: 20px;
}

</style>
<h1>Bestellingen Vandaag</h1>
<div class="orders-wrapper">
  <div class="order-grid">
  {% for order in orders %}
    {% set is_delivery = order.order_type in ['delivery', 'bezorgen'] %}
    <div class="order-card">
      <div class="order-header">
        <div class="order-number">#{{ order.order_number or '-' }}</div>
        <div class="{{ 'type-bezorging' if is_delivery else 'type-afhalen' }}">
          {{ 'Bezorging' if is_delivery else 'Afhalen' }}
        </div>
      </div>
      <div class="order-meta">
        <strong>Datum:</strong> {{ order.created_at_local.strftime('%Y-%m-%d') }}<br>
        <strong>Tijd:</strong> {{ order.created_at_local.strftime('%H:%M') }}<br>
        <strong>Klant:</strong> {{ order.customer_name or '-' }}<br>
        <strong>Telefoon:</strong> {{ order.phone or '-' }}<br>
        <strong>Email:</strong> {{ order.email or '-' }}<br>
        {% if is_delivery %}
          <strong>Adres:</strong> {{ order.street }} {{ order.house_number }} {{ order.postcode }} {{ order.city }}
          {% if order.maps_link %}
            <a href="{{ order.maps_link }}" target="_blank">üìçMaps</a>
          {% endif %}
          <br>
        {% endif %}
        <strong>Tijdslot:</strong> {{ order.delivery_time if is_delivery else order.pickup_time or '-' }}<br>
        <strong>Betaling:</strong> {{ order.payment_method or '-' }}
      </div>
      <div class="order-items">
        <strong>Items:</strong>
        <ul>
          {% for name, item in order.items_dict.items() %}
            <li>{{ name }} x {{ item['qty'] }}</li>
          {% endfor %}
        </ul>
      </div>
      <div class="order-footer">
        <strong>Opmerking:</strong> {{ order.opmerking or '-' }}<br>
        <strong>Totaal:</strong> ‚Ç¨{{ '%.2f' % (order.totaal or 0) }}
      </div>
    </div>
  {% endfor %}
</div>

</div>

<script>
  function orderComplete(btn) {
    const status = btn.nextElementSibling;
    const payload = {
      order_number: btn.dataset.number,
      name: btn.dataset.name,
      phone: btn.dataset.phone,
      email: btn.dataset.email,
      order_type: btn.dataset.type
    };
    fetch('https://flask-order-api.onrender.com/api/order_complete', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }).then(r => {
      if (r.ok) {
        status.textContent = 'Notificatie verzonden';
      } else {
        status.textContent = 'Notificatie mislukt';
      }
    }).catch(() => {
      status.textContent = 'Notificatie mislukt';
    });
  }

  function toggleComplete(btn) {
    const tr = btn.closest('tr');
    const id = tr.dataset.id;
    const done = !tr.classList.contains('completed');
    fetch(`/api/orders/${id}/status`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({is_completed: done})
    }).then(r=>r.json()).then(() => {
      if(done) orderComplete(btn);
      fetchOrders();
    });
  }

  function cancelOrder(btn) {
    const id = btn.closest('tr').dataset.id;
    fetch(`/api/orders/${id}/status`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({is_cancelled: true})
    }).then(()=>fetchOrders());
  }

  function editOrder(btn) {
    const tr = btn.closest('tr');
    const id = tr.dataset.id;
    const data = JSON.parse(tr.dataset.order || '{}');
    const name = prompt('Naam', data.customer_name || '');
    if(name === null) return;
    const phone = prompt('Telefoon', data.phone || '');
    if(phone === null) return;
    const email = prompt('Email', data.email || '');
    if(email === null) return;
    const street = prompt('Straat', data.street || '');
    if(street === null) return;
    const number = prompt('Huisnummer', data.house_number || '');
    if(number === null) return;
    const postcode = prompt('Postcode', data.postcode || '');
    if(postcode === null) return;
    const city = prompt('Plaats', data.city || '');
    if(city === null) return;
    const pickup = prompt('Afhaaltijd', data.pickup_time || '');
    if(pickup === null) return;
    const delivery = prompt('Bezorgtijd', data.delivery_time || '');
    if(delivery === null) return;

    fetch(`/api/orders/${id}`, {
      method:'PUT',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        customer_name:name, phone, email,
        street, house_number:number, postcode, city,
        pickup_time:pickup, delivery_time:delivery
      })
    }).then(()=>fetchOrders());
  }
</script>
